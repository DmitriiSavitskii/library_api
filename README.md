# üìö Library API

RESTful API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã–º –∫–∞—Ç–∞–ª–æ–≥–æ–º. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–Ω–∏–≥ –∏ —á–∏—Ç–∞—Ç–µ–ª–µ–π, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä–µ–π —á–µ—Ä–µ–∑ JWT, –ª–æ–≥–∏–∫–∞ –≤—ã–¥–∞—á–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–Ω–∏–≥ —Å –±–∏–∑–Ω–µ—Å-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏.

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**:
   ```bash
   git clone git@github.com:DmitriiSavitskii/library_api.git
   cd library_api
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`**:
   ```env
   POSTGRES_USER=postgres
   POSTGRES_PASSWORD=postgres
   POSTGRES_DB=library_postgres
   DATABASE_URL=postgresql://postgres:postgres@postgres:5432/library_postgres
   SECRET_KEY=your_secret_key
   ALGORITHM=HS256
   ACCESS_TOKEN_EXPIRE_MINUTES=30
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç —Å –ø–æ–º–æ—â—å—é Docker Compose**:
   ```bash
   docker-compose up -d
   ```

4. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)**:
   ```bash
   docker exec -it library_api alembic upgrade head
   ```

5. **–û—Ç–∫—Ä–æ–π—Ç–µ Swagger UI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API**:
   [http://localhost:8000/docs](http://localhost:8000/docs)

6. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:

   –û—Ç–ø—Ä–∞–≤—å—Ç–µ POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ `/auth/register`:
   ```json
   {
     "email": "admin@example.com",
     "password": "adminpassword"
   }
   ```

   –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ –æ—Ç–≤–µ—Ç–µ

6. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:

   –û—Ç–ø—Ä–∞–≤—å—Ç–µ POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ `/auth/login`:
   ```json
   {
     "email": "admin@example.com",
     "password": "adminpassword"
   }
   ```

   –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ –æ—Ç–≤–µ—Ç–µ, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ, –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É  `Authorize` –≤ –≤–µ—Ä—Ö–Ω–µ–º –ø—Ä–∞–≤–æ–º —É–≥–ª—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã [http://localhost:8000/docs](http://localhost:8000/docs) –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ –ø–æ–ª–µ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É `Authorize` –∑–∞—Ç–µ–º `Close`

---

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
.
‚îú‚îÄ‚îÄ alembic/                # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/               # –ù–∞—Å—Ç—Ä–æ–π–∫–∏, —Ç–æ–∫–µ–Ω—ã, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ models/             # SQLAlchemy –º–æ–¥–µ–ª–∏ (Book, Reader, Borrow, User)
‚îÇ   ‚îú‚îÄ‚îÄ routes/             # –†–æ—É—Ç—ã API —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
‚îÇ   ‚îú‚îÄ‚îÄ schemas/            # Pydantic-—Å—Ö–µ–º—ã –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ config.py           # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ database.py         # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ main.py             # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îú‚îÄ‚îÄ tests/                  # Pytest-—Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ alembic.ini
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

---

## üß† –†–µ—à–µ–Ω–∏—è –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ë–î

- **`books`**: –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –∫–Ω–∏–≥
- **`readers`**: –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è —á–∏—Ç–∞—Ç–µ–ª–µ–π
- **`borrows`**: –¢–∞–±–ª–∏—Ü–∞ –≤—ã–¥–∞—á –∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- **`users`**: –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π(–±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä–µ–π)

### –ü—Ä–∏—á–∏–Ω—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:
- –û—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `borrows` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–∏–≥ –≤ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ –±–æ–ª–µ–µ 3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–∏–≥).

---

## üîç –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### 4.1 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –Ω–µ –±–æ–ª–µ–µ 3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–∏–≥ –Ω–∞ –æ–¥–Ω–æ–≥–æ —á–∏—Ç–∞—Ç–µ–ª—è

–ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–π –≤—ã–¥–∞—á–∏ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —á–∏—Ç–∞—Ç–µ–ª—è. –ï—Å–ª–∏ —É–∂–µ 3 ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞.

### 4.2 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –Ω–µ–ª—å–∑—è –≤—ã–¥–∞—Ç—å –∫–Ω–∏–≥—É, –µ—Å–ª–∏ –≤—Å–µ –∫–æ–ø–∏–∏ –Ω–∞ —Ä—É–∫–∞—Ö

–ü–µ—Ä–µ–¥ –≤—ã–¥–∞—á–µ–π —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–¥–∞–Ω–Ω—ã—Ö –∫–æ–ø–∏–π –∫–Ω–∏–≥–∏. –ï—Å–ª–∏ –∫–æ–ø–∏–π < 1 , –≤—ã–¥–∞—á–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.

### 4.3 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –≤–æ–∑–≤—Ä–∞—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ –≤—ã–¥–∞–Ω–Ω–æ–π –∫–Ω–∏–≥–∏

–ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–Ω–æ–π –≤—ã–¥–∞—á–∏ –ø–æ `book_id` –∏ `reader_id`, –≥–¥–µ `return_date IS NULL`. –ï—Å–ª–∏ —Ç–∞–∫–æ–π –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –∑–∞–ø—Ä–µ—â—ë–Ω.

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—è —á–µ—Ä–µ–∑ `/auth/register`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è JWT-—Ç–æ–∫–µ–Ω.
2. –í—Ö–æ–¥ ‚Äî —á–µ—Ä–µ–∑ `/auth/login`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è JWT-—Ç–æ–∫–µ–Ω.
3. –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç —Ç–æ–∫–µ–Ω: `Authorization: Bearer <token>`.

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
- **`passlib[bcrypt]`** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π.
- **`python-jose`** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT-—Ç–æ–∫–µ–Ω–æ–≤.
- **`fastapi.security`** ‚Äî OAuth2PasswordBearer, Depends –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤.

### –ó–∞—â–∏—â–µ–Ω—ã:
- –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –∫—Ä–æ–º–µ `/auth/register`, `/auth/login` –∏ `/books/`.
- CRUD-–¥–æ—Å—Ç—É–ø –∫ –∫–Ω–∏–≥–∞–º, —á–∏—Ç–∞—Ç–µ–ª—è–º, –æ–ø–µ—Ä–∞—Ü–∏—è–º –≤—ã–¥–∞—á–∏/–≤–æ–∑–≤—Ä–∞—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç –¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—è.

–ü–æ—á–µ–º—É /books/ –æ—Ç–∫—Ä—ã—Ç:
–≠—Ç–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä. –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–∞–ª–æ–≥–∞ –∫–Ω–∏–≥ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª–µ–∑–µ–Ω –∫–∞–∫ –¥–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö, —Ç–∞–∫ –∏ –¥–ª—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–∏–≥–∏ –¥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏). –≠—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç —É–¥–æ–±—Å—Ç–≤–æ –∏ –¥–µ–ª–∞–µ—Ç API –±–æ–ª–µ–µ –¥–æ—Å—Ç—É–ø–Ω—ã–º –±–µ–∑ —É–≥—Ä–æ–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `pytest`, `httpx.AsyncClient` –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã.
- –î–ª—è —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `library_postgres_test` (–ø–æ—Ä—Ç 5433).
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `postgres_test` —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:
   ```bash
   docker-compose up -d postgres_test
   ```

- –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
   ```bash
   docker-compose exec web pytest
   ```

---

## üåü –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏—á–∞: –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –≤–æ–∑–≤—Ä–∞—Ç–µ

**–ò–¥–µ—è**: —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–∫–æ—Ä–æ–º –∏–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–º –≤–æ–∑–≤—Ä–∞—Ç–µ –∫–Ω–∏–≥.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –í `borrows` –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `due_date`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é +30 –¥–Ω–µ–π –æ—Ç `borrowed_at`.
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Celery –∏–ª–∏ cron) –∏—â–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å `due_date < now()` –∏ `return_date IS NULL`.
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ email –∏–ª–∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

---
